import{h as x,i as h,l as v,A as o,_ as B,w as A,d as u,P as l,j as b,C as N,k as S,c as a,a as t,m as k,t as m,n as y,F as f,f as p,q as E,u as P,o as i,s as I,v as j,x as D}from"./index.a54307ea.js";class g extends x{constructor(s){super(s.profile),this.ticketId=s.id}}class O{async getTicketsById(s){const c=await h.get(`api/events/${s}/tickets`);v.log("get tickets",c.data),o.tickets=c.data.map(e=>new g(e))}async attendEvent(s){const c=await h.post("api/tickets",s);v.log("getting a ticket",c.data),o.tickets.push(new g(c.data)),o.myEvents.push(new g(c.data))}async removeTicketToEvent(s){const c=await h.delete(`api/tickets/${s}`);v.log("removeing ticket",c.data);const e=o.myEvents.findIndex(n=>n.ticketId==s);e!==-1&&o.myEvents.splice(e,1)}}const C=new O,V={setup(){const d=P();async function s(){try{const n=d.params.eventId;await b.getEventById(n)}catch{j.push("/")}}async function c(){try{const n=d.params.eventId;await C.getTicketsById(n)}catch(n){v.error(n),l.error(n.message)}}async function e(){try{const n=d.params.eventId;await D.getCommentsByEventId(n)}catch(n){l.error(n.message)}}return A(()=>{d.params.eventId&&(s(),c(),e())}),{account:u(()=>o.account),event:u(()=>o.event),tickets:u(()=>o.tickets),comments:u(()=>o.comments),foundTickets:u(()=>o.tickets.find(n=>n.id==o.account.id)),async attendEvent(){try{await C.attendEvent({eventId:d.params.eventId})}catch(n){v.error(n),l.error(n.message)}},async removeTicketToEvent(n){try{await l.confirm("Are you sure?","Ok")&&await C.removeTicketToEvent(n)}catch(_){v.error(_),l.error(_.message)}},async cancelEvent(n){try{await b.cancelEvent(n)}catch(_){l.error(_,"Cancel Event")}}}},components:{Comments:N,CommentCard:S}},R={key:0,class:"container mt-3 border border-dark"},F={class:"row justify-content-center"},L={class:"col-md-12 d-flex justify-content-center"},q={class:""},M=["src"],W={class:"ms-2"},Y=t("b",null,"NAME:",-1),z=t("b",null,"DESCRIPTION:",-1),G=t("b",null,"LOCATION:",-1),H=t("b",null,"DATE:",-1),J=t("b",null,"CAPACITY:",-1),K=t("p",null,null,-1),Q={class:"d-flex justify-content-end mb-2"},U=["disabled"],X={key:3,class:"bg-danger rounded text-center p-3"},Z=t("i",{class:"mdi mdi-lock"},null,-1),$=t("span",null," Canceled ",-1),ee=[Z,$],te={class:"container-fluid"},ne={class:"row"},se={class:"col-md-12"},ce=t("p",null,[t("b",null,"Who is attending:")],-1),oe={class:"col-4"},ae=["src","alt","title"],ie={class:"container-fluid"},re={class:"row"},de={class:"col-md-12"},le=t("p",null,[t("b",null,"Comments:")],-1),me={class:"col-3"};function ve(d,s,c,e,n,_){const T=I("Comments"),w=I("CommentCard");return i(),a(f,null,[e.event?(i(),a("div",R,[t("div",F,[t("div",L,[t("div",q,[t("img",{src:e.event.coverImg,alt:"",class:"img-fluid border border-dark mt-2 mb-2"},null,8,M)]),t("div",W,[t("p",null,[Y,k(" "+m(e.event.name),1)]),t("p",null,[z,k(" "+m(e.event.description),1)]),t("p",null,[G,k(" "+m(e.event.location),1)]),t("p",null,[H,k(" "+m(e.event.startDate),1)]),t("p",null,[J,k(" "+m(e.event.capacity),1)]),K])]),t("div",Q,[!e.event.isCanceled&&e.account.id&&!e.foundTickets||!e.event.capacity?(i(),a("button",{key:0,onClick:s[0]||(s[0]=r=>e.attendEvent()),disabled:e.event.isCanceled||!e.event.capacity,class:"btn btn-success"},"Attend Event",8,U)):y("",!0),e.account.id&&e.foundTickets?(i(),a("button",{key:1,onClick:s[1]||(s[1]=r=>e.removeTicketToEvent(e.foundTickets.ticketId)),class:"btn btn-success"},"Return Ticket")):y("",!0),e.account.id==e.event.creatorId&&!e.event.isCanceled?(i(),a("button",{key:2,onClick:s[2]||(s[2]=r=>e.cancelEvent(e.event.id)),class:"btn btn-danger"}," Cancel ")):e.event.isCanceled?(i(),a("div",X,ee)):y("",!0)])])])):y("",!0),t("div",te,[t("div",ne,[t("div",se,[ce,(i(!0),a(f,null,p(e.tickets,r=>(i(),a("div",oe,[t("img",{class:"img-fluid rounded",src:r.picture,alt:r.name+" picture",title:r.name},null,8,ae),t("p",null,[t("b",null,m(r.name),1)])]))),256))])])]),E(T),t("div",ie,[t("div",re,[t("div",de,[le,(i(!0),a(f,null,p(e.comments,r=>(i(),a("div",me,[E(w,{comment:r},null,8,["comment"])]))),256))])])])],64)}const ue=B(V,[["render",ve]]);export{ue as default};
